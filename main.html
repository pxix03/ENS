<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ENS 메인</title>
<link rel="stylesheet" href="style.css">
<script src="data.js"></script>
<script src="search.js" defer></script>
</head>
<body>
<!-- ===== 공통 헤더 ===== -->
<div class="header">
  <div class="top-row">
    <a href="main.html" class="logo">ENS</a>
    <div class="search-box">
      <input id="globalSearch" type="text" placeholder="검색어를 입력하세요">
    </div>
    <div class="header-user" id="userDisplay"></div>
  </div>

  <div class="categories">
    <button onclick="location.href='main.html'">홈</button>
    <button onclick="location.href='main.html#NBA'">NBA</button>
    <button onclick="location.href='main.html#FC'">FC</button>
    <button onclick="location.href='main.html#E-스포츠'">E-스포츠</button>
    <button onclick="location.href='shop.html'">쇼핑</button>
    <button onclick="location.href='community.html'">커뮤니티</button>
    <button onclick="location.href='game.html'">경기</button>
  </div>
</div>

<!-- ⭐ 검색결과 박스: 위치 수정 (헤더 바로 아래) -->
<div id="searchResultBox" class="search-result-box"></div>



<!-- =============== 메인 배너 =============== -->
<div class="main-banner" onclick="goShopping()">
  <img id="mainBannerImg" src="">
  <div id="mainBannerText" class="banner-text"></div>
  <button class="banner-left" onclick="event.stopPropagation(); prevBanner()">〈</button>
  <button class="banner-right" onclick="event.stopPropagation(); nextBanner()">〉</button>
</div>

<!-- 메인 콘텐츠 -->
<div id="mainContent" class="main-content-area"></div>

<!-- =============== 모달 =============== -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeProduct()">&times;</span>
    <img id="modalImg" src="">
    <h2 id="modalName"></h2>
    <p id="modalDesc"></p>
  </div>
</div>

<!-- =============== 메인 배너 슬라이드 + 탭 JS =============== -->
<script>
/* -------------------------
   메인 배너 슬라이드
-------------------------- */
const bannerData = [
  {
    src:"https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1200&q=80",
    text:"NBA 할인 특가!"
  },
  {
    src:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=1200&q=80",
    text:"FC 인기 유니폼 세일!"
  },
  {
    src:"https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=1200&q=80",
    text:"E-스포츠 장비 기획전!"
  }
];

let bannerIndex = 0;
let bannerTimer = null;

function applyBanner() {
  const img = document.getElementById("mainBannerImg");
  const textEl = document.getElementById("mainBannerText");
  if (!img || !textEl || !bannerData.length) return;

  const item = bannerData[bannerIndex];
  img.src = item.src;
  textEl.textContent = item.text;
}
function nextBanner() {
  if (!bannerData.length) return;
  bannerIndex = (bannerIndex + 1) % bannerData.length;
  applyBanner();
}
function prevBanner() {
  if (!bannerData.length) return;
  bannerIndex = (bannerIndex - 1 + bannerData.length) % bannerData.length;
  applyBanner();
}
function startBannerTimer() {
  if (bannerTimer) clearInterval(bannerTimer);
  bannerTimer = setInterval(nextBanner, 5000);
}
function goShopping() {
  location.href = "shop.html";
}

/* -------------------------
   메인 카테고리 상태
-------------------------- */
let currentCategory = null;          // "NBA" / "FC" / "E-스포츠" / null
let currentCategoryMode = "players"; // "players" / "standings"

/* 전체(홈) : 모든 카테고리 선수 목록 */
function renderAllCategories() {
  const box = document.getElementById("mainContent");
  if (!box) return;

  box.innerHTML = "";

  for (let cat in playerData) {
    box.innerHTML += `<div class="section-title">${cat}</div>`;

    const list = playerData[cat] || [];
    if (!list.length) {
      box.innerHTML += `
        <div style="padding:24px 8px; opacity:.7;">
          등록된 선수가 없습니다.
        </div>`;
      continue;
    }

    let html = `<div class="products-scroll">`;
    list.forEach(p => {
      html += `
        <div class="product" onclick='openProduct("${p.name}")'>
          <img src="${p.img}">
          <div class="product-title">${p.name}</div>
        </div>`;
    });
    html += "</div>";

    box.innerHTML += html;
  }
}

/* 카테고리 상단(제목 + 탭) 뼈대 그리기 */
function renderCategoryHeader(cat) {
  const box = document.getElementById("mainContent");
  if (!box) return;

  box.innerHTML = `
    <div class="category-header-row">
      <div class="section-title">${cat}</div>
      <div class="category-mode-tabs">
        <button class="category-mode-btn active"
                data-mode="players"
                onclick="changeCategoryMode('players')">선수찾기</button>
        <button class="category-mode-btn"
                data-mode="standings"
                onclick="changeCategoryMode('standings')">순위</button>
      </div>
    </div>
    <div id="categoryPlayers" class="category-panel"></div>
    <div id="categoryStandings" class="category-panel hidden"></div>
  `;
}

/* 탭 1 : 선수찾기(지금처럼 선수 목록) */
function renderCategoryPlayers(cat) {
  const panel = document.getElementById("categoryPlayers");
  if (!panel) return;

  const list = playerData[cat] || [];

  if (!list.length) {
    panel.innerHTML = `
      <div style="padding:30px 10px; opacity:.7;">
        등록된 선수가 없습니다.
      </div>`;
    return;
  }

  let html = `<div class="products-scroll">`;
  list.forEach(p => {
    html += `
      <div class="product" onclick='openProduct("${p.name}")'>
        <img src="${p.img}">
        <div class="product-title">${p.name}</div>
      </div>`;
  });
  html += "</div>";

  panel.innerHTML = html;
}

/* 탭 2 : 순위(사진처럼 테이블) */
function renderCategoryStandings(cat) {
  const panel = document.getElementById("categoryStandings");
  if (!panel) return;

  const league = (typeof standingsData !== "undefined" && standingsData[cat])
    ? standingsData[cat]
    : null;

  if (!league || !league.length) {
    panel.innerHTML = `
      <div style="padding:30px 10px; opacity:.7;">
        순위 정보가 준비 중입니다.
      </div>`;
    return;
  }

  const rows = league.map((t, idx) => {
    const played = t.played != null ? t.played : (t.win + t.draw + t.loss);
    const gf = t.gf || 0;
    const ga = t.ga || 0;
    const gd = gf - ga;
    const points = t.points != null ? t.points : (t.win * 3 + t.draw);

    return `
      <tr>
        <td>${t.rank != null ? t.rank : (idx + 1)}</td>
        <td class="league-standing-team">${t.team}</td>
        <td>${points}</td>
        <td>${played}</td>
        <td>${t.win}</td>
        <td>${t.draw}</td>
        <td>${t.loss}</td>
        <td>${gf}</td>
        <td>${ga}</td>
        <td>${gd}</td>
        <td class="league-standing-form">${t.form || ""}</td>
      </tr>`;
  }).join("");

  panel.innerHTML = `
    <div class="league-standing-wrap">
      <table class="league-standing-table">
        <thead>
          <tr>
            <th>순위</th>
            <th>팀</th>
            <th>승점</th>
            <th>경기</th>
            <th>승</th>
            <th>무</th>
            <th>패</th>
            <th>득점</th>
            <th>실점</th>
            <th>득실</th>
            <th>최근 5경기</th>
          </tr>
        </thead>
        <tbody>
          ${rows}
        </tbody>
      </table>
    </div>
  `;
}

/* 탭 클릭 시 */
function changeCategoryMode(mode) {
  currentCategoryMode = mode;

  const playersPanel = document.getElementById("categoryPlayers");
  const standingsPanel = document.getElementById("categoryStandings");

  if (playersPanel && standingsPanel) {
    playersPanel.classList.toggle("hidden", mode !== "players");
    standingsPanel.classList.toggle("hidden", mode !== "standings");
  }

  document.querySelectorAll(".category-mode-btn").forEach(btn => {
    const btnMode = btn.dataset.mode;
    btn.classList.toggle("active", btnMode === mode);
  });
}

/* 실제로 카테고리 하나 화면을 그리는 함수
   (= 여기 안에 선수찾기 탭 + 순위 탭 둘 다 들어감) */
function showCategory(cat) {
  currentCategory = cat;
  currentCategoryMode = "players";

  const banner = document.querySelector(".main-banner");
  if (banner) banner.style.display = "none";

  renderCategoryHeader(cat);
  renderCategoryPlayers(cat);     // 기본 탭
  renderCategoryStandings(cat);   // 미리 만들어두고 숨겨둠
}

/* 홈(전체)로 돌아갈 때 */
function showAll() {
  currentCategory = null;
  currentCategoryMode = "players";

  const banner = document.querySelector(".main-banner");
  if (banner) banner.style.display = "block";

  renderAllCategories();
}

/* 주소창 #해시를 보고 NBA / FC / E-스포츠 탭인지 판단 */
function applyCategoryFromHash() {
  const hashRaw = location.hash.replace("#", "");
  const cat = decodeURIComponent(hashRaw);

  if (cat === "NBA" || cat === "FC" || cat === "E-스포츠") {
    showCategory(cat);
  } else {
    showAll();
  }
}

/* 선수 카드 클릭 시 모달 */
function openProduct(name){
  for(let cat in playerData){
    const item = playerData[cat].find(x => x.name === name);
    if(item){
      document.getElementById("modalImg").src = item.img;
      document.getElementById("modalName").textContent = item.name;
      document.getElementById("modalDesc").textContent = item.desc || "";
      document.getElementById("productModal").style.display = "flex";
      return;
    }
  }
}
function closeProduct(){
  document.getElementById("productModal").style.display = "none";
}

/* 초기화 */
document.addEventListener("DOMContentLoaded", () => {
  // 배너
  applyBanner();
  startBannerTimer();

  // 카테고리 (홈 / NBA / FC / E-스포츠)
  applyCategoryFromHash();
  window.addEventListener("hashchange", applyCategoryFromHash);
});
</script>
</body>
</html>

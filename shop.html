<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ENS 쇼핑</title>
<link rel="stylesheet" href="style.css">
<script src="data.js"></script>
<script src="search.js" defer></script>
<script src="auth.js" defer></script>
<script src="cart.js" defer></script>
<script src="tabs-history.js"></script>
</head>
<body>
<!-- ===== 공통 헤더 ===== -->
<div class="header">
  <div class="top-row">
    <a href="index.html" class="logo">ENS</a>
    <div class="search-box">
      <input id="globalSearch" type="text" placeholder="검색어를 입력하세요">
    </div>

    <div class="header-user" id="userDisplay"></div>
  </div>

  <div class="categories">
  <button onclick="location.href='index.html'">홈</button>
  <button onclick="location.href='nba.html'">NBA</button>
  <button onclick="location.href='epl.html'">EPL</button>
  <button onclick="location.href='esports.html'">E-스포츠</button>
  <button onclick="location.href='shop.html'">쇼핑</button>
  <button onclick="location.href='community.html'">커뮤니티</button>
  <button onclick="location.href='game.html'">경기</button>
  </div>
</div>

<!-- 검색 결과 박스 -->
<div id="searchResultBox" class="search-result-box"></div>


<!-- ============================
     쇼핑 콘텐츠
============================= -->
<div class="shop-container">

  <!-- 상단 배너 -->
  <div class="shop-banner">
    <img src="https://images.unsplash.com/photo-1461897104016-0b3b00cc81ee?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="쇼핑 배너">
    <div class="shop-banner-text">
      <div class="shop-banner-sub">스포츠 팬들을 위한 특별 기획전</div>
      <div class="shop-banner-main">PREMIUM SPORTS SHOP</div>
      <div class="shop-banner-desc">농구 · 축구 · E-스포츠 용품을 한번에 만나보세요</div>
    </div>
  </div>

  <!-- 좌측 카테고리 + 중앙 상품 영역 -->
  <div class="shop-layout">
    <!-- 왼쪽 : 카테고리 -->
    <aside class="shop-sidebar">
      <div class="shop-sidebar-title">카테고리</div>
      <ul class="shop-category-list">
        <li><button class="shop-cat-btn active" data-cat="ALL" onclick="changeShopCategory('ALL', this)">전체 보기</button></li>
        <li><button class="shop-cat-btn" data-cat="농구" onclick="changeShopCategory('농구', this)">농구</button></li>
        <li><button class="shop-cat-btn" data-cat="축구" onclick="changeShopCategory('축구', this)">축구</button></li>
        <li><button class="shop-cat-btn" data-cat="E-스포츠" onclick="changeShopCategory('E-스포츠', this)">E-스포츠</button></li>
        <li><button class="shop-cat-btn" data-cat="용품" onclick="changeShopCategory('용품', this)">기타 용품</button></li>
      </ul>
    </aside>

    <!-- 가운데 : 상품 리스트 -->
    <main class="shop-main">
      <div class="shop-main-header">
        <h1>쇼핑</h1>
        <div class="shop-main-info">
          총 <span id="shopCount">0</span>개 상품
          <button type="button" class="shop-cart-link" onclick="goCartPage()">장바구니 보기</button>
        </div>
      </div>

      <div id="shopList" class="products-grid"></div>
    </main>
  </div>
</div>

<!-- ============================
     JS
============================= -->
<script>
let currentShopCategory = "ALL";

// 상품 이름으로 카테고리 자동 판별
function getShopCategory(item) {
  const name = item.name || "";
  if (name.includes("농구")) return "농구";
  if (name.includes("축구")) return "축구";
  if (name.includes("게이밍") || name.toLowerCase().includes("gaming")) return "E-스포츠";
  return "용품"; // 나머지
}

// 카테고리 변경 + 히스토리 반영
function changeShopCategory(cat, btn, push = true) {
  currentShopCategory = cat;

  // 왼쪽 버튼 active 처리
  document.querySelectorAll(".shop-cat-btn").forEach(b => {
    const btnCat = b.dataset.cat;
    b.classList.toggle("active", btnCat === cat);
  });
  if (btn) {
    btn.classList.add("active");
  }

  renderShop();

  // URL / 히스토리 (?scat=농구 등)
  if (window.updateTabHistory && push) {
    updateTabHistory("scat", cat, true);
  }
}


// 상품 리스트 렌더링
function renderShop(){
  const box = document.getElementById("shopList");
  const countEl = document.getElementById("shopCount");
  if (!box) return;

  box.innerHTML = "";

  // 선택된 카테고리 기준 필터링
  const filtered = shopData.filter(item => {
    const cat = getShopCategory(item);
    return currentShopCategory === "ALL" || cat === currentShopCategory;
  });

  if (countEl) countEl.textContent = filtered.length;

  if (filtered.length === 0) {
    box.innerHTML = `<div class="empty-post">해당 카테고리에 상품이 없습니다.</div>`;
    return;
  }

  filtered.forEach(item => {
    box.innerHTML += `
      <div class="product" onclick='openProductDetail("${item.name}")'>
        <img src="${item.img}">
        <div class="product-title">${item.name}</div>
        <div class="product-price">${item.price}</div>
      </div>
    `;
  });
}
function openProductDetail(name) {
  const url = `product.html?name=${encodeURIComponent(name)}`;
  location.href = url;
}

// 카테고리 + 히스토리 초기 세팅
if (window.setupTabHistory) {
  setupTabHistory("scat", "ALL", (cat, push) => {
    const btn = document.querySelector(`.shop-cat-btn[data-cat="${cat}"]`);
    changeShopCategory(cat, btn || null, push);
  });
} else {
  // fallback
  const btn = document.querySelector('.shop-cat-btn[data-cat="ALL"]');
  changeShopCategory("ALL", btn || null, false);
}

function goCartPage() {
  location.href = "cart.html";
}

</script>

</body>
</html>


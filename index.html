<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ENS 메인</title>
<link rel="stylesheet" href="style.css">
<script src="data.js"></script>
<script src="search.js" defer></script>
<script src="auth.js" defer></script>
<script src="cart.js" defer></script>
<script src="tabs-history.js"></script>

</head>
<body>
<!-- ===== 공통 헤더 ===== -->
<div class="header">
  <div class="top-row">
    <a href="index.html" class="logo">ENS</a>
    <div class="search-box">
      <input id="globalSearch" type="text" placeholder="검색어를 입력하세요">
    </div>
    <div class="header-user" id="userDisplay"></div>
  </div>

  <div class="categories">
  <button onclick="location.href='index.html'">홈</button>
  <button onclick="location.href='nba.html'">NBA</button>
  <button onclick="location.href='epl.html'">EPL</button>
  <button onclick="location.href='esports.html'">E-스포츠</button>
  <button onclick="location.href='shop.html'">쇼핑</button>
  <button onclick="location.href='community.html'">커뮤니티</button>
  <button onclick="location.href='game.html'">경기</button>
  </div>
</div>

<!-- ⭐ 검색결과 박스: 위치 수정 (헤더 바로 아래) -->
<div id="searchResultBox" class="search-result-box"></div>

<!-- =============== 메인 배너 =============== -->
<div class="main-banner" onclick="goShopping()">
  <img id="mainBannerImg" src="">
  <div id="mainBannerText" class="banner-text"></div>
  <button class="banner-left" onclick="event.stopPropagation(); prevBanner()">〈</button>
  <button class="banner-right" onclick="event.stopPropagation(); nextBanner()">〉</button>
</div>

<!-- 메인 콘텐츠 -->
<div id="mainContent" class="main-content-area"></div>

<!-- =============== 모달 =============== -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeProduct()">&times;</span>
    <img id="modalImg" src="">
    <h2 id="modalName"></h2>
    <p id="modalDesc"></p>
  </div>
</div>

<!-- =============== 메인 배너 슬라이드 + 탭 JS =============== -->
<script>
/* -------------------------
   메인 배너 슬라이드
-------------------------- */
const bannerData = [
  {
    src:"https://images.unsplash.com/photo-1661951933279-257856cda111?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    text:"NBA 할인 특가!"
  },
  {
    src:"https://wallpapers.com/images/hd/premier-league-logo-in-blue-op2y0y49xfn7hbh7.jpg",
    text:"EPL 인기 유니폼 세일!"
  },
  {
    src:"https://images.unsplash.com/photo-1633545491399-54a16aa6a871?q=80&w=1472&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    text:"E-스포츠 장비 기획전!"
  }
];

let bannerIndex = 0;
let bannerTimer = null;

function applyBanner() {
  const img = document.getElementById("mainBannerImg");
  const textEl = document.getElementById("mainBannerText");
  if (!img || !textEl || !bannerData.length) return;

  const item = bannerData[bannerIndex];
  img.src = item.src;
  textEl.textContent = item.text;
}
function nextBanner() {
  if (!bannerData.length) return;
  bannerIndex = (bannerIndex + 1) % bannerData.length;
  applyBanner();
}
function prevBanner() {
  if (!bannerData.length) return;
  bannerIndex = (bannerIndex - 1 + bannerData.length) % bannerData.length;
  applyBanner();
}
function startBannerTimer() {
  if (bannerTimer) clearInterval(bannerTimer);
  bannerTimer = setInterval(nextBanner, 5000);
}
function goShopping() {
  location.href = "shop.html";
}

/* 전체(홈) : 모든 카테고리 선수 목록 */
function renderAllCategories() {
  const box = document.getElementById("mainContent");
  if (!box) return;

  box.innerHTML = "";

  for (let cat in playerData) {
    box.innerHTML += `<div class="section-title">${cat}</div>`;

    const list = playerData[cat] || [];
    if (!list.length) {
      box.innerHTML += `
        <div style="padding:24px 8px; opacity:.7;">
          등록된 선수가 없습니다.
        </div>`;
      continue;
    }

    let html = `<div class="products-scroll">`;
    list.forEach(p => {
      html += `
        <div class="product" onclick='openProduct("${p.name}")'>
          <img src="${p.img}">
          <div class="product-title">${p.name}</div>
        </div>`;
    });
    html += "</div>";

    box.innerHTML += html;
  }
}

/* 선수 카드 클릭 시 모달 + 히스토리 연동 */
function openProduct(name, push = true) {
  for (let cat in playerData) {
    const item = playerData[cat].find(x => x.name === name);
    if (item) {
      document.getElementById("modalImg").src = item.img;
      document.getElementById("modalName").textContent = item.name;
      document.getElementById("modalDesc").textContent = item.desc || "";
      document.getElementById("productModal").style.display = "flex";

      // 카드 클릭으로 열린 경우에만 히스토리 추가 (?pmodal=이름)
      if (push && window.updateTabHistory) {
        updateTabHistory("pmodal", name, true);
      }
      return;
    }
  }
}

function closeProduct(push = true) {
  document.getElementById("productModal").style.display = "none";

  // X 버튼 등으로 직접 닫았을 때,
  // 현재 history.state에 pmodal 값이 있으면
  // 한 단계 뒤로 가서 "모달이 닫힌 홈 상태"로 돌려놓기
  if (push && window.history && history.state && history.state.pmodal) {
    history.back();
  }
}


/* 초기화 */
document.addEventListener("DOMContentLoaded", () => {
  // 배너
  applyBanner();
  startBannerTimer();
  renderAllCategories();

  // 카드(선수 모달) 뒤로가기 연동
  if (window.setupTabHistory) {
    // key: "pmodal", 기본값: "" (모달 닫힌 상태)
    setupTabHistory("pmodal", "", (name, push) => {
      if (name) {
        // 뒤로가기/앞으로가기 또는 URL 직접 진입으로 모달 열릴 때
        openProduct(name, false);   // 여기서는 history에 다시 안 쌓게 push=false
      } else {
        // pmodal 값이 비어 있을 때는 모달 닫기
        closeProduct(false);
      }
    });
  }
});

</script>
</body>
</html>

